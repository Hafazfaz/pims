<!-- Mobile Overlay -->
<div x-show="sidebarOpen" @click="sidebarOpen = false" x-cloak
  class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
  x-transition:enter="transition-opacity ease-linear duration-300" x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-linear duration-300"
  x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"></div>

<!-- Sidebar -->
<aside
  class="w-64 bg-slate-900 text-white flex-shrink-0 flex-col border-r border-slate-800 top-0 left-0 h-screen overflow-y-auto fixed z-50 lg:z-50 lg:flex"
  :class="sidebarOpen ? 'flex' : 'hidden'" x-cloak>
  <div class="p-8">
    <div class="flex items-center space-x-3 mb-10">
      <div class="w-8 h-8 bg-nigeria-green rounded flex items-center justify-center font-bold text-lg">
        N
      </div>
      <span class="text-xl font-bold tracking-tight">PIMS</span>
    </div>

    <!-- prettier-ignore-start -->
    <nav class="space-y-6">
      <!-- MAIN SECTION -->
      <div>
        <p class="px-4 mb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Main</p>
        <div class="space-y-1">
          <a href="{% if user.is_superuser %}{% url 'user_management:admin_dashboard_health' %}{% elif user.staff.is_registry %}{% url 'document_management:registry' %}{% elif user.staff.is_hod or user.staff.is_unit_manager %}{% url 'document_management:executive_dashboard' %}{% else %}{% url 'home' %}{% endif %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if request.resolver_match.url_name == 'home' or request.resolver_match.url_name == 'registry' or request.resolver_match.url_name == 'executive_dashboard' or 'admin/dashboard/health' in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Dashboard</span>
          </a>

          {% if not user.is_superuser %}
          {% if not user.staff.is_registry %}
          <!-- My Files - for ALL staff -->
          <a href="{% url 'document_management:my_files' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if request.resolver_match.url_name == 'my_files' %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">My Files</span>
          </a>
          {% endif %}

          <!-- Record Explorer - for registry/HOD/unit managers only -->
          {% if user.staff.is_registry or user.staff.is_hod or user.staff.is_unit_manager %}
          <a href="{% url 'document_management:record_explorer' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if request.resolver_match.url_name == 'record_explorer' %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Record Explorer</span>
          </a>
          {% endif %}

          <a href="{% url 'document_management:messages' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if request.resolver_match.url_name == 'messages' %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Messages</span>
          </a>
          {% endif %}
        </div>
      </div>

      {% if not user.is_superuser %}
      {% if user.staff.is_registry %}
      <!-- REGISTRY SECTION (Registry users only) -->
      <div>
        <p class="px-4 mb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Registry</p>
        <div class="space-y-1">
          <a href="{% url 'document_management:registry_hub' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if '/registry/hub' in request.path and 'access-requests' not in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Folder Hub</span>
          </a>

          <a href="{% url 'document_management:access_request_list' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if 'access-requests' in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Access Requests</span>
          </a>
        </div>
      </div>
      {% endif %}
      {% endif %}

      {% if user.is_superuser or perms.auth.view_user or user.staff.is_executive %}
      <!-- MANAGEMENT SECTION -->
      <div>
        <p class="px-4 mb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Management</p>
        <div class="space-y-1">
          {% if user.is_superuser or perms.auth.view_user %}
          <a href="{% url 'user_management:user_list' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if 'user_management' in request.path and 'admin/dashboard' not in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Users</span>
          </a>
          {% endif %}

          {% if user.is_superuser %}
          <a href="{% url 'organization:department_list' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if '/org/departments/' in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Departments</span>
          </a>
          <a href="{% url 'organization:unit_list' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if '/org/units/' in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Units</span>
          </a>
          {% endif %}

          {% if user.is_superuser or user.is_staff or user.staff.is_executive %}
          <a href="{% url 'audit_log:audit_log_list' %}"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-slate-800 transition-colors {% if 'audit' in request.path %}bg-nigeria-green text-white{% else %}text-slate-400{% endif %}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
              </path>
            </svg>
            <span class="text-sm font-bold uppercase tracking-wider">Audit Logs</span>
          </a>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </nav>
    <!-- prettier-ignore-end -->
  </div>

  <div class="mt-auto p-4 border-t border-slate-800">
    <div class="bg-slate-800 rounded-xl p-4 flex flex-col space-y-3">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 rounded bg-slate-700 flex items-center justify-center text-xs font-bold">
          {{ user.username|slice:":1"|upper }}
        </div>
        <div class="flex-1 overflow-hidden">
          <p class="text-[11px] font-bold truncate">{{ user.username }}</p>
          <p class="text-[9px] text-slate-400 truncate uppercase tracking-widest">
            {{ user.staff.designation.name }}
          </p>
        </div>
      </div>

      <div class="pt-3 border-t border-slate-700 flex flex-col space-y-2">
        <a href="{% url 'user_management:profile' %}"
          class="flex items-center space-x-2 text-[10px] font-black text-slate-400 hover:text-white uppercase tracking-widest transition-colors">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span>My Profile</span>
        </a>

        <form action="{% url 'user_management:logout' %}" method="post">
          {% csrf_token %}
          <button
            class="flex items-center space-x-2 text-[10px] font-black text-slate-400 hover:text-red-400 uppercase tracking-widest transition-colors">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            <span>Logout</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</aside>